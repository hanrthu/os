### <center>Lab3</center>

<center>计71 韩荣 2016010189</center>

#### 练习1

##### 思路

​	本练习的量不大，但需要先观看视频和讲义，并阅读相关代码后，了解do_pgfault函数的触发机制。因为do_pgfault被触发时，可能是非法访存或者合理访存，函数已有的部分是对访存的合法性进行验证。在需要填写的部分，我们要处理的情况是：第一次访问一个页面，在vma_struct中出现，但在页表中没有，需要为他分配物理页，调用pgdir_alloc_page函数

即可实现功能，需要注意的是，可以进行适当的assert来避免一些极端情况。

##### 请描述页目录项和页表中组成部分对ucore实现页替换算法的潜在用处

若要实现其他算法如拓展时钟算法，那么我们需要对访问和修改情况进行一些记录，可以用到Acess和Dirty位的信息。

##### 如果ucore的缺页服务例程在执行过程中访问内存，出现了页访问异常，请问硬件要做哪些事情？

这就是我们课上说的double_fault，即不进入缺页异常，而是进入double_fault异常来处理。但是这个情况一般不会发生。



#### 练习2

##### 思路

​	本练习是在上一个练习后进行，需要实现fifo置换算法，并完善do_pgfault中的else，用于处理页面换到了swap分区中的情况，首先需要查找和调入该页，然后进行insert置换掉被唤出的页。我们的置换方法为fifo，即插入页到fifo队尾，替换队首的页面。



##### 如果要在ucore上实现"extended clock"页替换算法

##### 1、需要被换出的页的特征是什么？

优先换出Access和Dirty位均为0的，其次替换Access为0而Dirty为1的，如果不存在这样的页，则再进行一圈扫描，并修改Access位。

##### 2、在ucore中如何判断具有这样特征的页？

获取页对应的Page Table Entry(PTE)，然后获取Access和Dirty位。

##### 3、何时进行换入和换出

换入操作是在发生缺页异常之后，而换出操作则根据策略而定，若采用积极策略，则隔一段时间主动换出；若采用消极策略，则等到物理内存已满的时候才进行换出。



#### 实验中的重要知识点

虚拟内存和物理内存的储存关系（双向链表），虚拟存储的交换技术和虚拟页的存储方法。虚拟页的置换方法和方法的利弊（如简便、belady等）



#### 实现中与参考答案的区别

练习1:原始实现中没有assert，在参考了参考答案后，增加了assert，提高了程序的安全性。

练习2:fifo的实现大致相同，仍然缺少assert，参考后添加上。